"use strict";var myMap,hamburger=document.querySelector(".hamburger"),menu=document.querySelector(".menu");hamburger.addEventListener("click",function(e){e.preventDefault(),menu.classList.toggle("menu--active"),hamburger.classList.toggle("hamburger--active")}),function(){function i(e){var t=e.find(".assortment-menu__item"),e=e.find(".assortment-menu__content");t.removeClass("active"),e.width(0)}function r(e){var t=0,n=$(window).width(),o=3*e.find(".assortment-menu__title").width(),a=e.find(".assortment-menu__container"),e=parseInt(a.css("padding-left")),a=parseInt(a.css("padding-right"));return{container:t=window.matchMedia("(max-width: 768px)").matches?n-o:500,textContainer:t-e-a}}var a;a=$("assortment-menu__title"),$(document).ready(function(){for(var e=0;e<a.length;e++)!function(e){var o=a[e];o.addEventListener("click",function(e){e.preventDefault();for(var t=0;t<a.length;t++){var n=a[t];n!==e.currentTarget&&n.closest(".assortment-menu__item").classList.remove("assortment-menu__item--active")}o.closest(".assortment-menu__item").classList.toggle("assortment-menu__item--active")})}(e)});$(".assortment-menu__title").click(function(e){e.preventDefault();var t=$(e.currentTarget),n=t.closest(".assortment-menu__item"),o=n.hasClass("active"),a=t.closest(".assortment-menu");o?i(a):(i(a),t=(e=n).find(".assortment-menu__content"),o=r(e).container,a=e.find(".assortment-menu__container"),n=r(e).textContainer,e.addClass("--active"),t.width(o),a.width(n))}),$(".assortment-menu__close").click(function(e){e.preventDefault(),i($(".assortment-menu"))})}();var init=function(){myMap=new ymaps.Map("map",{center:[51.530777,46.035694],zoom:11,controls:[]});for(var e=[[51.550777,46.055694],[51.540777,46.075694],[51.530777,46.045694],[51.479213,46.085694]],t=new ymaps.GeoObjectCollection({},{draggable:!1,iconLayout:"default#image",iconImageHref:"./img/decor/marker.png",iconImageSize:[46,57],iconImageOffset:[-35,-52]}),n=0;n<e.length;n++)t.add(new ymaps.Placemark(e[n]));myMap.geoObjects.add(t),myMap.behaviors.disable("scrollZoom")};ymaps.ready(init);var validateForm=function(e,t){return t.forEach(function(e){e.removeClass("input-error"),""==e.val().trim()&&e.addClass("input-error")}),0==e.find(".input-error").length};$(".form").submit(function(e){e.preventDefault();var t=$(e.currentTarget),n=t.find("[name='name']"),o=t.find("[name='phone']"),a=t.find("[name='comment']"),e=t.find("[name='to']"),i=$("#modal"),r=i.find(".modal__content");i.removeClass("error-modal"),validateForm(t,[n,o,a,e])&&((e=$.ajax({url:"https://webdev-api.loftschool.com/sendmail",method:"post",data:{name:n.val(),phone:o.val(),comment:a.val(),to:e.val()}})).done(function(e){r.text(e.message)}),e.fail(function(e){e=e.responseJSON.message;r.text(e),i.addClass("error-modal")}),e.always(function(){$.fancybox.open({src:"#modal",type:"inline"})}))}),$(".js-submit-btn").click(function(e){e.preventDefault(),$.fancybox.close()});var sections=$("section"),display=$(".maincontent"),sideMenu=$(".fixed-menu"),menuItems=sideMenu.find(".fixed-menu__item"),mobileDetect=new MobileDetect(window.navigator.userAgent),isMobile=mobileDetect.mobile(),inScroll=!1;sections.first().addClass("active");var durationControl,soundControl,intervalId,countSectionPosition=function(e){e*=-100;return isNaN(e)?(console.error("передано не верное значение в countSectionPosition"),0):e},changeMenuThemeForSection=function(e){var t="fixed-menu--shadowed";"black"===sections.eq(e).attr("data-sidemenu-theme")?sideMenu.addClass(t):sideMenu.removeClass(t)},resetActiveClassForItem=function(e,t,n){e.eq(t).addClass(n).siblings().removeClass(n)},performTransition=function(e){var t;inScroll||(inScroll=!0,t=countSectionPosition(e),changeMenuThemeForSection(e),display.css({transform:"translateY(".concat(t,"%)")}),resetActiveClassForItem(sections,e,"active"),resetActiveClassForItem(menuItems,e,"fixed-menu__item--active"),setTimeout(function(){inScroll=!1},1300))},viewportScroller=function(){var e=sections.filter(".active"),t=e.next(),n=e.prev();return{next:function(){t.length&&performTransition(t.index())},prev:function(){n.length&&performTransition(n.index())}}};$(window).on("wheel",function(e){var t=e.originalEvent.deltaY,e=viewportScroller();0<t&&e.next(),t<0&&e.prev()}),$(window).on("keydown",function(e){var t=e.target.tagName.toLowerCase(),t="input"===t||"textarea"===t,n=viewportScroller();if(!t)switch(e.keyCode){case 38:n.prev();break;case 40:n.next()}}),$(".wrapper").on("touchmove",function(e){return e.preventDefault()}),$("[data-scroll-to]").click(function(e){e.preventDefault();e=$(e.currentTarget).attr("data-scroll-to"),e=$("[data-section-id=".concat(e,"]"));performTransition(e.index())}),isMobile&&$("body").swipe({swipe:function(e,t){viewportScroller()["down"===t?"prev":"up"===t?"next":""]()}});var video,playBtn=document.querySelector(".video__player-img"),soundBtn=document.querySelector(".sound"),playerPlayBtn=document.querySelector(".duration__img");(video=document.getElementById("player")).addEventListener("click",playStop);for(var playButtons=document.querySelectorAll(".play"),i=0;i<playButtons.length;i++)playButtons[i].addEventListener("click",playStop);var micControl=document.getElementById("mic");function playStop(){playBtn.classList.toggle("video__player-img--active"),video.paused?(video.play(),intervalId=setInterval(updateDuration,1e3/60),playerPlayBtn.classList.add("active")):(video.pause(),clearInterval(intervalId),playerPlayBtn.classList.remove("active"))}function setVideoDuration(){video.currentTime=durationControl.value,updateDuration()}function updateDuration(){durationControl.value=video.currentTime;var e=video.duration/100,e=video.currentTime/e;durationControl.style.background="linear-gradient(90deg, #E01F3D 0%, #E01F3D ".concat(e,"%, #333333 ").concat(e,"%)")}function soundOf(){0===video.volume?(video.volume=soundLevel,soundControl.value=10*soundLevel,soundBtn.classList.remove("active")):(soundLevel=video.volume,video.volume=0,soundControl.value=0,soundBtn.classList.add("active"))}function changeSoundVolume(){video.volume=soundControl.value/10,0==video.volume?soundBtn.classList.add("active"):soundBtn.classList.remove("active"),console.log("значение volume у видео "+video.volume),console.log("значение value у micLevel "+soundControl.value/10)}micControl.addEventListener("click",soundOf),(durationControl=document.getElementById("durationLevel")).addEventListener("input",setVideoDuration),durationControl.min=0,durationControl.value=0,durationControl.max=video.duration,(soundControl=document.getElementById("micLevel")).addEventListener("input",changeSoundVolume),soundControl.min=0,soundControl.max=10,soundControl.value=soundControl.max,video.addEventListener("ended",function(){playBtn.classList.toggle("video__player-img--active"),video.currentTime=0,playerPlayBtn.classList.remove("active")});var findBlockByAlias=function(n){return $(".rewiews__item").filter(function(e,t){return $(t).attr("data-link")==n})};$(".interactive-avatar").click(function(e){e.preventDefault();var t=$(e.currentTarget),e=t.attr("data-open"),e=findBlockByAlias(e),t=t.closest(".rewiews__switcher-item");e.addClass("rewiews__item--active").siblings().removeClass("rewiews__item--active"),t.addClass("interactive-avatar--active").siblings().removeClass("interactive-avatar--active")});var slider=$(".slider__list").bxSlider({pager:!1,controls:!1});$(".slider__button--prev").click(function(e){e.preventDefault(),slider.goToPrevSlide()}),$(".slider__button--next").click(function(e){e.preventDefault(),slider.goToNextSlide()});var openItem=function(e){var t=e.closest(".team__item"),n=t.find(".team__content"),e=n.find(".team__content-block").height();t.addClass("active"),n.height(e)},closeEveryItem=function(e){var t=e.find(".team__content");e.find(".team__item").removeClass("active"),t.height(0)};$(".team__name").click(function(e){e.preventDefault();var t=$(e.currentTarget),e=t.closest(".team");t.closest(".team__item").hasClass("active")?closeEveryItem(e):(closeEveryItem(e),openItem(t))});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZ1bGxzY3JlZW4tbWVudS5qcyIsIm1hcC5qcyIsImhvcml6b250YWwtYWNjby5qcyIsIm1vZGFsLmpzIiwib3BzLmpzIiwicGxheWVyLmpzIiwicmV3aWV3cy5qcyIsInNsaWRlci5qcyIsInRlYW0uanMiXSwibmFtZXMiOlsibXlNYXAiLCJoYW1idXJnZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJtZW51IiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImNsYXNzTGlzdCIsInRvZ2dsZSIsImNsb3NlRXZlcnlJdGVtSW5Db250YWluZXIiLCJjb250YWluZXIiLCJpdGVtcyIsImZpbmQiLCJjb250ZW50IiwicmVtb3ZlQ2xhc3MiLCJ3aWR0aCIsIm1lYXN1cmVXaWR0aCIsImJsb2NrIiwiaXRlbVdpZHRoIiwic2NyZWVuV2lkdGgiLCIkIiwid2luZG93IiwidGl0bGVzV2lkdGgiLCJ0ZXh0Q29udGFpbmVyIiwicGFkZGluZ0xlZnQiLCJwYXJzZUludCIsImNzcyIsInBhZGRpbmdSaWdodCIsIm1hdGNoTWVkaWEiLCJtYXRjaGVzIiwibWVudUJ0biIsInJlYWR5IiwiaSIsImxlbmd0aCIsImVsZW1lbnQiLCJpbmRleCIsImN1cnJlbnRUYXJnZXQiLCJjbG9zZXN0IiwicmVtb3ZlIiwiX2xvb3AiLCJjbGljayIsIiR0aGlzIiwiaXRlbSIsIml0ZW1PcGVuZWQiLCJoYXNDbGFzcyIsImhpZGRlbkJsb2NrIiwicmVxV2lkdGgiLCJ0ZXh0QmxvY2siLCJ0ZXh0QmxvY2tXaWR0aCIsImFkZENsYXNzIiwiaW5pdCIsInltYXBzIiwiTWFwIiwiY2VudGVyIiwiem9vbSIsImNvbnRyb2xzIiwiY29vcmRzIiwibXlDb2xsZWN0aW9uIiwiR2VvT2JqZWN0Q29sbGVjdGlvbiIsImRyYWdnYWJsZSIsImljb25MYXlvdXQiLCJpY29uSW1hZ2VIcmVmIiwiaWNvbkltYWdlU2l6ZSIsImljb25JbWFnZU9mZnNldCIsImFkZCIsIlBsYWNlbWFyayIsImdlb09iamVjdHMiLCJiZWhhdmlvcnMiLCJkaXNhYmxlIiwidmFsaWRhdGVGb3JtIiwiZm9ybSIsImZpZWxkc0FycmF5IiwiZm9yRWFjaCIsImZpZWxkIiwidmFsIiwidHJpbSIsInN1Ym1pdCIsIm5hbWUiLCJwaG9uZSIsImNvbW1lbnQiLCJ0byIsIm1vZGFsIiwicmVxdWVzdCIsImFqYXgiLCJ1cmwiLCJtZXRob2QiLCJkYXRhIiwiZG9uZSIsInRleHQiLCJtZXNzYWdlIiwiZmFpbCIsInJlc3BvbnNlSlNPTiIsImFsd2F5cyIsImZhbmN5Ym94Iiwib3BlbiIsInNyYyIsInR5cGUiLCJjbG9zZSIsInNlY3Rpb25zIiwiZGlzcGxheSIsInNpZGVNZW51IiwibWVudUl0ZW1zIiwibW9iaWxlRGV0ZWN0IiwiTW9iaWxlRGV0ZWN0IiwibmF2aWdhdG9yIiwidXNlckFnZW50IiwiaXNNb2JpbGUiLCJtb2JpbGUiLCJpblNjcm9sbCIsImZpcnN0IiwiZHVyYXRpb25Db250cm9sIiwic291bmRDb250cm9sIiwiaW50ZXJ2YWxJZCIsImNvdW50U2VjdGlvblBvc2l0aW9uIiwic2VjdGlvbkVxIiwicG9zaXRpb24iLCJpc05hTiIsImNvbnNvbGUiLCJlcnJvciIsImNoYW5nZU1lbnVUaGVtZUZvclNlY3Rpb24iLCJhY3RpdmVDbGFzcyIsImVxIiwiYXR0ciIsInJlc2V0QWN0aXZlQ2xhc3NGb3JJdGVtIiwiaXRlbUVxIiwic2libGluZ3MiLCJwZXJmb3JtVHJhbnNpdGlvbiIsInRyYW5zZm9ybSIsImNvbmNhdCIsInNldFRpbWVvdXQiLCJ0cmFuc2l0aW9uT3ZlciIsInZpZXdwb3J0U2Nyb2xsZXIiLCJhY3RpdmVTZWN0aW9uIiwiZmlsdGVyIiwibmV4dFNlY3Rpb24iLCJuZXh0IiwicHJldlNlY3Rpb24iLCJwcmV2Iiwib24iLCJkZWx0YVkiLCJvcmlnaW5hbEV2ZW50Iiwic2Nyb2xsZXIiLCJ0YWdOYW1lIiwidGFyZ2V0IiwidG9Mb3dlckNhc2UiLCJ1c2VyVHlwaW5nSW5JbnB1dHMiLCJrZXlDb2RlIiwicmVxU2VjdGlvbiIsInN3aXBlIiwiZXZlbnQiLCJkaXJlY3Rpb24iLCJ2aWRlbyIsInBsYXlCdG4iLCJzb3VuZEJ0biIsInBsYXllclBsYXlCdG4iLCJnZXRFbGVtZW50QnlJZCIsInBsYXlTdG9wIiwicGxheUJ1dHRvbnMiLCJxdWVyeVNlbGVjdG9yQWxsIiwibWljQ29udHJvbCIsInBhdXNlZCIsInBsYXkiLCJzZXRJbnRlcnZhbCIsInVwZGF0ZUR1cmF0aW9uIiwicGF1c2UiLCJjbGVhckludGVydmFsIiwic2V0VmlkZW9EdXJhdGlvbiIsImN1cnJlbnRUaW1lIiwidmFsdWUiLCJzdGVwIiwiZHVyYXRpb24iLCJwZXJjZW50Iiwic3R5bGUiLCJiYWNrZ3JvdW5kIiwic291bmRPZiIsInZvbHVtZSIsInNvdW5kTGV2ZWwiLCJjaGFuZ2VTb3VuZFZvbHVtZSIsImxvZyIsIm1pbiIsIm1heCIsImZpbmRCbG9ja0J5QWxpYXMiLCJhbGlhcyIsIm5keCIsImN1cnJlbnQiLCJpdGVtVG9TaG93IiwiY3VySXRlbSIsInNsaWRlciIsImJ4U2xpZGVyIiwicGFnZXIiLCJnb1RvUHJldlNsaWRlIiwiZ29Ub05leHRTbGlkZSIsIm9wZW5JdGVtIiwiY29udGVudEJsb2NrIiwicmVxSGVpZ2h0IiwiaGVpZ2h0IiwiY2xvc2VFdmVyeUl0ZW0iXSwibWFwcGluZ3MiOiJhQUFBLElDQUFBLE1EQUFDLFVBQUFDLFNBQUFDLGNBQUEsY0FDQUMsS0FBQUYsU0FBQUMsY0FBQSxTQUVBRixVQUFBSSxpQkFBQSxRQUFBLFNBQUFDLEdBQ0FBLEVBQUFDLGlCQVVBSCxLQUFBSSxVQUFBQyxPQUFBLGdCQUNBUixVQUFBTyxVQUFBQyxPQUFBLHVCRWZBLFdBQ0EsU0FBQUMsRUFBQUMsR0FDQSxJQUFBQyxFQUFBRCxFQUFBRSxLQUFBLDBCQUNBQyxFQUFBSCxFQUFBRSxLQUFBLDZCQUVBRCxFQUFBRyxZQUFBLFVBQ0FELEVBQUFFLE1BQUEsR0FHQSxTQUFBQyxFQUFBQyxHQUNBLElBQUFDLEVBQUEsRUFFQUMsRUFBQUMs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QUFBeEksU0FBQSx5QkFBQTRFLFdBQUEvRyxZQUFBLHlCQUNBNEssRUFBQXpJLFNBQUEsOEJBQUE0RSxXQUFBL0csWUFBQSxnQ0NmQSxJQUFBNkssT0FBQXZLLEVBQUEsaUJBQUF3SyxTQUFBLENBQ0FDLE9BQUEsRUFDQXRJLFVBQUEsSUFHQW5DLEVBQUEseUJBQUFvQixNQUFBLFNBQUFuQyxHQUNBQSxFQUFBQyxpQkFDQXFMLE9BQUFHLGtCQUlBMUssRUFBQSx5QkFBQW9CLE1BQUEsU0FBQW5DLEdBQ0FBLEVBQUFDLGlCQUNBcUwsT0FBQUksa0JDYkEsSUFBQUMsU0FBQSxTQUFBdEosR0FDQSxJQUFBaEMsRUFBQWdDLEVBQUFMLFFBQUEsZUFDQTRKLEVBQUF2TCxFQUFBRSxLQUFBLGtCQUVBc0wsRUFEQUQsRUFBQXJMLEtBQUEsd0JBQ0F1TCxTQUVBekwsRUFBQXVDLFNBQUEsVUFDQWdKLEVBQUFFLE9BQUFELElBR0FFLGVBQUEsU0FBQTFMLEdBQ0EsSUFBQUMsRUFBQUQsRUFBQUUsS0FBQSxrQkFDQUYsRUFBQUUsS0FBQSxlQUVBRSxZQUFBLFVBQ0FILEVBQUF3TCxPQUFBLElBR0EvSyxFQUFBLGVBQUFvQixNQUFBLFNBQUFuQyxHQUNBQSxFQUFBQyxpQkFDQSxJQUFBbUMsRUFBQXJCLEVBQUFmLEVBQUErQixlQUNBMUIsRUFBQStCLEVBQUFKLFFBQUEsU0FDQUksRUFBQUosUUFBQSxlQUVBTyxTQUFBLFVBQ0F3SixlQUFBMUwsSUFFQTBMLGVBQUExTCxHQUNBc0wsU0FBQXZKIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBoYW1idXJnZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGFtYnVyZ2VyJyk7XHJcbmNvbnN0IG1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1lbnVcIik7XHJcblxyXG5oYW1idXJnZXIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGUgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgIC8vIGlmIChoYW1idXJnZXIuY2xhc3NMaXN0LmNvbnRhaW5zKFwiaGFtYnVyZ2VyLS1hY3RpdmVcIikpIHtcclxuICAgIC8vICAgICBtZW51LmNsYXNzTGlzdC5yZW1vdmUoXCJtZW51LS1hY3RpdmVcIik7XHJcbiAgICAvLyAgICAgaGFtYnVyZ2VyLmNsYXNzTGlzdC5yZW1vdmUoXCJoYW1idXJnZXItLWFjdGl2ZVwiKTtcclxuICAgIC8vIH0gZWxzZSB7XHJcbiAgICAvLyAgICAgbWVudS5jbGFzc0xpc3QuYWRkKFwibWVudS0tYWN0aXZlXCIpO1xyXG4gICAgLy8gICAgIGhhbWJ1cmdlci5jbGFzc0xpc3QuYWRkKFwiaGFtYnVyZ2VyLS1hY3RpdmVcIik7XHJcbiAgICAvLyB9XHJcblxyXG4gICAgbWVudS5jbGFzc0xpc3QudG9nZ2xlKFwibWVudS0tYWN0aXZlXCIpO1xyXG4gICAgaGFtYnVyZ2VyLmNsYXNzTGlzdC50b2dnbGUoXCJoYW1idXJnZXItLWFjdGl2ZVwiKTtcclxufSk7XHJcbiIsImxldCBteU1hcDtcclxuY29uc3QgaW5pdCA9ICgpID0+IHtcclxuICAgIG15TWFwID0gbmV3IHltYXBzLk1hcChcIm1hcFwiLCB7XHJcbiAgICAgICAgY2VudGVyOiBbNTEuNTMwNzc3LCA0Ni4wMzU2OTRdLFxyXG4gICAgICAgIHpvb206IDExLFxyXG4gICAgICAgIGNvbnRyb2xzOiBbXSxcclxuICAgIH0pO1xyXG5cclxuICAgIGxldCBjb29yZHMgPSBbXHJcbiAgICAgICAgWzUxLjU1MDc3NywgNDYuMDU1Njk0XSxcclxuICAgICAgICBbNTEuNTQwNzc3LCA0Ni4wNzU2OTRdLFxyXG4gICAgICAgIFs1MS41MzA3NzcsIDQ2LjA0NTY5NF0sXHJcbiAgICAgICAgWzUxLjQ3OTIxMywgNDYuMDg1Njk0XSxcclxuICAgIF0sXHJcbiAgICAgICAgbXlDb2xsZWN0aW9uID0gbmV3IHltYXBzLkdlb09iamVjdENvbGxlY3Rpb24oe30sIHtcclxuICAgICAgICAgICAgZHJhZ2dhYmxlOiBmYWxzZSxcclxuICAgICAgICAgICAgaWNvbkxheW91dDogJ2RlZmF1bHQjaW1hZ2UnLFxyXG4gICAgICAgICAgICBpY29uSW1hZ2VIcmVmOiAnLi9pbWcvZGVjb3IvbWFya2VyLnBuZycsXHJcbiAgICAgICAgICAgIGljb25JbWFnZVNpemU6IFs0NiwgNTddLFxyXG4gICAgICAgICAgICBpY29uSW1hZ2VPZmZzZXQ6IFstMzUsIC01Ml1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvb3Jkcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIG15Q29sbGVjdGlvbi5hZGQobmV3IHltYXBzLlBsYWNlbWFyayhjb29yZHNbaV0pKTtcclxuICAgIH1cclxuXHJcbiAgICBteU1hcC5nZW9PYmplY3RzLmFkZChteUNvbGxlY3Rpb24pO1xyXG5cclxuICAgIG15TWFwLmJlaGF2aW9ycy5kaXNhYmxlKCdzY3JvbGxab29tJyk7XHJcbn07XHJcblxyXG55bWFwcy5yZWFkeShpbml0KTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnN0IGNsb3NlRXZlcnlJdGVtSW5Db250YWluZXIgPSAoY29udGFpbmVyKSA9PiB7XHJcbiAgICAgICAgY29uc3QgaXRlbXMgPSBjb250YWluZXIuZmluZChcIi5hc3NvcnRtZW50LW1lbnVfX2l0ZW1cIik7XHJcbiAgICAgICAgY29uc3QgY29udGVudCA9IGNvbnRhaW5lci5maW5kKFwiLmFzc29ydG1lbnQtbWVudV9fY29udGVudFwiKTtcclxuXHJcbiAgICAgICAgaXRlbXMucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgICAgICAgY29udGVudC53aWR0aCgwKTtcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgbWVhc3VyZVdpZHRoID0gKGJsb2NrKSA9PiB7XHJcbiAgICAgICAgbGV0IGl0ZW1XaWR0aCA9IDA7XHJcblxyXG4gICAgICAgIGNvbnN0IHNjcmVlbldpZHRoID0gJCh3aW5kb3cpLndpZHRoKCk7XHJcbiAgICAgICAgY29uc3QgdGl0bGVzV2lkdGggPSBibG9jay5maW5kKFwiLmFzc29ydG1lbnQtbWVudV9fdGl0bGVcIikud2lkdGgoKSAqIDM7XHJcbiAgICAgICAgY29uc3QgdGV4dENvbnRhaW5lciA9IGJsb2NrLmZpbmQoXCIuYXNzb3J0bWVudC1tZW51X19jb250YWluZXJcIik7XHJcbiAgICAgICAgY29uc3QgcGFkZGluZ0xlZnQgPSBwYXJzZUludCh0ZXh0Q29udGFpbmVyLmNzcyhcInBhZGRpbmctbGVmdFwiKSk7XHJcbiAgICAgICAgY29uc3QgcGFkZGluZ1JpZ2h0ID0gcGFyc2VJbnQodGV4dENvbnRhaW5lci5jc3MoXCJwYWRkaW5nLXJpZ2h0XCIpKTtcclxuXHJcbiAgICAgICAgY29uc3QgaXNNb2JpbGUgPSB3aW5kb3cubWF0Y2hNZWRpYShcIihtYXgtd2lkdGg6IDc2OHB4KVwiKTtcclxuXHJcbiAgICAgICAgaWYgKGlzTW9iaWxlLm1hdGNoZXMpIHtcclxuICAgICAgICAgICAgaXRlbVdpZHRoID0gc2NyZWVuV2lkdGggLSB0aXRsZXNXaWR0aFxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGl0ZW1XaWR0aCA9IDUwMFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgY29udGFpbmVyOiBpdGVtV2lkdGgsXHJcbiAgICAgICAgICAgIHRleHRDb250YWluZXI6IGl0ZW1XaWR0aCAtIHBhZGRpbmdMZWZ0IC0gcGFkZGluZ1JpZ2h0XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcblxyXG4gICAgKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb25zdCBtZW51QnRuID0gJCgnYXNzb3J0bWVudC1tZW51X190aXRsZScpO1xyXG5cclxuICAgICAgICAkKGRvY3VtZW50KS5yZWFkeSgoKSA9PiB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWVudUJ0bi5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IG1lbnVCdG5baV07XHJcblxyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IG1lbnVCdG4ubGVuZ3RoOyBpbmRleCsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSBtZW51QnRuW2luZGV4XTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50ICE9PSBlLmN1cnJlbnRUYXJnZXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xvc2VzdCgnLmFzc29ydG1lbnQtbWVudV9faXRlbScpLmNsYXNzTGlzdC5yZW1vdmUoJ2Fzc29ydG1lbnQtbWVudV9faXRlbS0tYWN0aXZlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5jbG9zZXN0KCcuYXNzb3J0bWVudC1tZW51X19pdGVtJykuY2xhc3NMaXN0LnRvZ2dsZSgnYXNzb3J0bWVudC1tZW51X19pdGVtLS1hY3RpdmUnKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KSgpO1xyXG5cclxuICAgIGNvbnN0IG9wZW5JdGVtID0gKGl0ZW0pID0+IHtcclxuICAgICAgICBjb25zdCBoaWRkZW5CbG9jayA9IGl0ZW0uZmluZChcIi5hc3NvcnRtZW50LW1lbnVfX2NvbnRlbnRcIik7XHJcbiAgICAgICAgY29uc3QgcmVxV2lkdGggPSBtZWFzdXJlV2lkdGgoaXRlbSkuY29udGFpbmVyO1xyXG4gICAgICAgIGNvbnN0IHRleHRCbG9jayA9IGl0ZW0uZmluZChcIi5hc3NvcnRtZW50LW1lbnVfX2NvbnRhaW5lclwiKTtcclxuICAgICAgICBjb25zdCB0ZXh0QmxvY2tXaWR0aCA9IG1lYXN1cmVXaWR0aChpdGVtKS50ZXh0Q29udGFpbmVyO1xyXG5cclxuICAgICAgICBpdGVtLmFkZENsYXNzKFwiLS1hY3RpdmVcIik7XHJcbiAgICAgICAgaGlkZGVuQmxvY2sud2lkdGgocmVxV2lkdGgpO1xyXG4gICAgICAgIHRleHRCbG9jay53aWR0aCh0ZXh0QmxvY2tXaWR0aClcclxuICAgIH07XHJcblxyXG4gICAgJChcIi5hc3NvcnRtZW50LW1lbnVfX3RpdGxlXCIpLmNsaWNrKChlKSA9PiB7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICAgICAgICBjb25zdCBpdGVtID0gJHRoaXMuY2xvc2VzdChcIi5hc3NvcnRtZW50LW1lbnVfX2l0ZW1cIik7XHJcbiAgICAgICAgY29uc3QgaXRlbU9wZW5lZCA9IGl0ZW0uaGFzQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gJHRoaXMuY2xvc2VzdChcIi5hc3NvcnRtZW50LW1lbnVcIik7XHJcblxyXG4gICAgICAgIGlmIChpdGVtT3BlbmVkKSB7XHJcbiAgICAgICAgICAgIGNsb3NlRXZlcnlJdGVtSW5Db250YWluZXIoY29udGFpbmVyKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjbG9zZUV2ZXJ5SXRlbUluQ29udGFpbmVyKGNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgIG9wZW5JdGVtKGl0ZW0pO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgICQoXCIuYXNzb3J0bWVudC1tZW51X19jbG9zZVwiKS5jbGljaygoZSkgPT4ge1xyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgY2xvc2VFdmVyeUl0ZW1JbkNvbnRhaW5lcigkKCcuYXNzb3J0bWVudC1tZW51JykpO1xyXG4gICAgfSk7XHJcbn0oKSk7IiwiY29uc3QgdmFsaWRhdGVGb3JtID0gKGZvcm0sIGZpZWxkc0FycmF5KSA9PiB7XHJcblxyXG4gICAgZmllbGRzQXJyYXkuZm9yRWFjaCgoZmllbGQpID0+IHtcclxuICAgICAgICBmaWVsZC5yZW1vdmVDbGFzcyhcImlucHV0LWVycm9yXCIpO1xyXG4gICAgICAgIGlmIChmaWVsZC52YWwoKS50cmltKCkgPT0gXCJcIikge1xyXG4gICAgICAgICAgICBmaWVsZC5hZGRDbGFzcyhcImlucHV0LWVycm9yXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IGVycm9yRmllbGQgPSBmb3JtLmZpbmQoXCIuaW5wdXQtZXJyb3JcIik7XHJcblxyXG4gICAgcmV0dXJuIGVycm9yRmllbGQubGVuZ3RoID09IDA7XHJcbn1cclxuXHJcbiQoXCIuZm9ybVwiKS5zdWJtaXQoZSA9PiB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG5cclxuICAgIGNvbnN0IGZvcm0gPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgICBjb25zdCBuYW1lID0gZm9ybS5maW5kKFwiW25hbWU9J25hbWUnXVwiKTtcclxuICAgIGNvbnN0IHBob25lID0gZm9ybS5maW5kKFwiW25hbWU9J3Bob25lJ11cIik7XHJcbiAgICBjb25zdCBjb21tZW50ID0gZm9ybS5maW5kKFwiW25hbWU9J2NvbW1lbnQnXVwiKTtcclxuICAgIGNvbnN0IHRvID0gZm9ybS5maW5kKFwiW25hbWU9J3RvJ11cIik7XHJcblxyXG4gICAgY29uc3QgbW9kYWwgPSAkKFwiI21vZGFsXCIpO1xyXG4gICAgY29uc3QgY29udGVudCA9IG1vZGFsLmZpbmQoXCIubW9kYWxfX2NvbnRlbnRcIik7XHJcblxyXG4gICAgbW9kYWwucmVtb3ZlQ2xhc3MoXCJlcnJvci1tb2RhbFwiKTtcclxuXHJcbiAgICBjb25zdCBpc1ZhbGlkID0gdmFsaWRhdGVGb3JtKGZvcm0sIFtuYW1lLCBwaG9uZSwgY29tbWVudCwgdG9dKTtcclxuXHJcblxyXG5cclxuICAgIGlmIChpc1ZhbGlkKSB7XHJcbiAgICAgICAgY29uc3QgcmVxdWVzdCA9ICQuYWpheCh7XHJcbiAgICAgICAgICAgIHVybDogXCJodHRwczovL3dlYmRldi1hcGkubG9mdHNjaG9vbC5jb20vc2VuZG1haWxcIixcclxuICAgICAgICAgICAgbWV0aG9kOiBcInBvc3RcIixcclxuICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgbmFtZTogbmFtZS52YWwoKSxcclxuICAgICAgICAgICAgICAgIHBob25lOiBwaG9uZS52YWwoKSxcclxuICAgICAgICAgICAgICAgIGNvbW1lbnQ6IGNvbW1lbnQudmFsKCksXHJcbiAgICAgICAgICAgICAgICB0bzogdG8udmFsKCksXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJlcXVlc3QuZG9uZShkYXRhID0+IHtcclxuICAgICAgICAgICAgY29udGVudC50ZXh0KGRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJlcXVlc3QuZmFpbCgoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gZGF0YS5yZXNwb25zZUpTT04ubWVzc2FnZTtcclxuICAgICAgICAgICAgY29udGVudC50ZXh0KG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICBtb2RhbC5hZGRDbGFzcyhcImVycm9yLW1vZGFsXCIpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXF1ZXN0LmFsd2F5cygoKSA9PiB7XHJcbiAgICAgICAgICAgICQuZmFuY3lib3gub3Blbih7XHJcbiAgICAgICAgICAgICAgICBzcmM6IFwiI21vZGFsXCIsXHJcbiAgICAgICAgICAgICAgICB0eXBlOiBcImlubGluZVwiLFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSk7XHJcblxyXG4kKFwiLmpzLXN1Ym1pdC1idG5cIikuY2xpY2soKGUpID0+IHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAkLmZhbmN5Ym94LmNsb3NlKCk7XHJcbn0pOyIsImNvbnN0IHNlY3Rpb25zID0gJChcInNlY3Rpb25cIik7XHJcbmNvbnN0IGRpc3BsYXkgPSAkKFwiLm1haW5jb250ZW50XCIpO1xyXG5jb25zdCBzaWRlTWVudSA9ICQoXCIuZml4ZWQtbWVudVwiKTtcclxuY29uc3QgbWVudUl0ZW1zID0gc2lkZU1lbnUuZmluZChcIi5maXhlZC1tZW51X19pdGVtXCIpO1xyXG5cclxuY29uc3QgbW9iaWxlRGV0ZWN0ID0gbmV3IE1vYmlsZURldGVjdCh3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudCk7XHJcbmNvbnN0IGlzTW9iaWxlID0gbW9iaWxlRGV0ZWN0Lm1vYmlsZSgpO1xyXG5cclxubGV0IGluU2Nyb2xsID0gZmFsc2U7XHJcblxyXG5zZWN0aW9ucy5maXJzdCgpLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xyXG5cclxuY29uc3QgY291bnRTZWN0aW9uUG9zaXRpb24gPSAoc2VjdGlvbkVxKSA9PiB7XHJcbiAgICBjb25zdCBwb3NpdGlvbiA9IHNlY3Rpb25FcSAqIC0xMDA7XHJcblxyXG4gICAgaWYgKGlzTmFOKHBvc2l0aW9uKSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCLQv9C10YDQtdC00LDQvdC+INC90LUg0LLQtdGA0L3QvtC1INC30L3QsNGH0LXQvdC40LUg0LIgY291bnRTZWN0aW9uUG9zaXRpb25cIik7XHJcbiAgICAgICAgcmV0dXJuIDA7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHBvc2l0aW9uO1xyXG59O1xyXG5cclxuY29uc3QgY2hhbmdlTWVudVRoZW1lRm9yU2VjdGlvbiA9IChzZWN0aW9uRXEpID0+IHtcclxuICAgIGNvbnN0IGN1cnJlbnRTZWN0aW9uID0gc2VjdGlvbnMuZXEoc2VjdGlvbkVxKTtcclxuICAgIGNvbnN0IG1lbnVUaGVtZSA9IGN1cnJlbnRTZWN0aW9uLmF0dHIoXCJkYXRhLXNpZGVtZW51LXRoZW1lXCIpO1xyXG4gICAgY29uc3QgYWN0aXZlQ2xhc3MgPSBcImZpeGVkLW1lbnUtLXNoYWRvd2VkXCI7XHJcblxyXG4gICAgaWYgKG1lbnVUaGVtZSA9PT0gXCJibGFja1wiKSB7XHJcbiAgICAgICAgc2lkZU1lbnUuYWRkQ2xhc3MoYWN0aXZlQ2xhc3MpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBzaWRlTWVudS5yZW1vdmVDbGFzcyhhY3RpdmVDbGFzcyk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5jb25zdCByZXNldEFjdGl2ZUNsYXNzRm9ySXRlbSA9IChpdGVtcywgaXRlbUVxLCBhY3RpdmVDbGFzcykgPT4ge1xyXG4gICAgaXRlbXMuZXEoaXRlbUVxKS5hZGRDbGFzcyhhY3RpdmVDbGFzcykuc2libGluZ3MoKS5yZW1vdmVDbGFzcyhhY3RpdmVDbGFzcyk7XHJcbn07XHJcblxyXG5jb25zdCBwZXJmb3JtVHJhbnNpdGlvbiA9IChzZWN0aW9uRXEpID0+IHtcclxuICAgIGlmIChpblNjcm9sbCkgcmV0dXJuO1xyXG5cclxuICAgIGNvbnN0IHRyYW5zaXRpb25PdmVyID0gMTAwMDtcclxuICAgIGNvbnN0IG1vdXNlSW5lcnRpYU92ZXIgPSAzMDA7XHJcblxyXG4gICAgaW5TY3JvbGwgPSB0cnVlO1xyXG5cclxuICAgIGNvbnN0IHBvc2l0aW9uID0gY291bnRTZWN0aW9uUG9zaXRpb24oc2VjdGlvbkVxKTtcclxuXHJcbiAgICBjaGFuZ2VNZW51VGhlbWVGb3JTZWN0aW9uKHNlY3Rpb25FcSk7XHJcblxyXG4gICAgZGlzcGxheS5jc3Moe1xyXG4gICAgICAgIHRyYW5zZm9ybTogYHRyYW5zbGF0ZVkoJHtwb3NpdGlvbn0lKWAsXHJcbiAgICB9KTtcclxuXHJcbiAgICByZXNldEFjdGl2ZUNsYXNzRm9ySXRlbShzZWN0aW9ucywgc2VjdGlvbkVxLCBcImFjdGl2ZVwiKTtcclxuICAgIHJlc2V0QWN0aXZlQ2xhc3NGb3JJdGVtKG1lbnVJdGVtcywgc2VjdGlvbkVxLCBcImZpeGVkLW1lbnVfX2l0ZW0tLWFjdGl2ZVwiKTtcclxuXHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICBpblNjcm9sbCA9IGZhbHNlO1xyXG4gICAgfSwgdHJhbnNpdGlvbk92ZXIgKyBtb3VzZUluZXJ0aWFPdmVyKTtcclxufTtcclxuXHJcbmNvbnN0IHZpZXdwb3J0U2Nyb2xsZXIgPSAoKSA9PiB7XHJcbiAgICBjb25zdCBhY3RpdmVTZWN0aW9uID0gc2VjdGlvbnMuZmlsdGVyKFwiLmFjdGl2ZVwiKTtcclxuICAgIGNvbnN0IG5leHRTZWN0aW9uID0gYWN0aXZlU2VjdGlvbi5uZXh0KCk7XHJcbiAgICBjb25zdCBwcmV2U2VjdGlvbiA9IGFjdGl2ZVNlY3Rpb24ucHJldigpO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgbmV4dCgpIHtcclxuICAgICAgICAgICAgaWYgKG5leHRTZWN0aW9uLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgcGVyZm9ybVRyYW5zaXRpb24obmV4dFNlY3Rpb24uaW5kZXgoKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIHByZXYoKSB7XHJcbiAgICAgICAgICAgIGlmIChwcmV2U2VjdGlvbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHBlcmZvcm1UcmFuc2l0aW9uKHByZXZTZWN0aW9uLmluZGV4KCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgIH07XHJcbn07XHJcblxyXG4kKHdpbmRvdykub24oXCJ3aGVlbFwiLCAoZSkgPT4ge1xyXG4gICAgY29uc3QgZGVsdGFZID0gZS5vcmlnaW5hbEV2ZW50LmRlbHRhWTtcclxuICAgIGNvbnN0IHNjcm9sbGVyID0gdmlld3BvcnRTY3JvbGxlcigpO1xyXG5cclxuICAgIGlmIChkZWx0YVkgPiAwKSB7XHJcbiAgICAgICAgc2Nyb2xsZXIubmV4dCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChkZWx0YVkgPCAwKSB7XHJcbiAgICAgICAgc2Nyb2xsZXIucHJldigpO1xyXG4gICAgfVxyXG59KTtcclxuXHJcbiQod2luZG93KS5vbihcImtleWRvd25cIiwgKGUpID0+IHtcclxuICAgIGNvbnN0IHRhZ05hbWUgPSBlLnRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XHJcbiAgICBjb25zdCB1c2VyVHlwaW5nSW5JbnB1dHMgPSB0YWdOYW1lID09PSBcImlucHV0XCIgfHwgdGFnTmFtZSA9PT0gXCJ0ZXh0YXJlYVwiO1xyXG4gICAgY29uc3Qgc2Nyb2xsZXIgPSB2aWV3cG9ydFNjcm9sbGVyKCk7XHJcblxyXG4gICAgaWYgKHVzZXJUeXBpbmdJbklucHV0cykgcmV0dXJuO1xyXG5cclxuICAgIHN3aXRjaCAoZS5rZXlDb2RlKSB7XHJcbiAgICAgICAgY2FzZSAzODpcclxuICAgICAgICAgICAgc2Nyb2xsZXIucHJldigpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgY2FzZSA0MDpcclxuICAgICAgICAgICAgc2Nyb2xsZXIubmV4dCgpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgIH1cclxufSk7XHJcblxyXG4kKFwiLndyYXBwZXJcIikub24oXCJ0b3VjaG1vdmVcIiwgKGUpID0+IGUucHJldmVudERlZmF1bHQoKSk7XHJcblxyXG4kKFwiW2RhdGEtc2Nyb2xsLXRvXVwiKS5jbGljaygoZSkgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgIGNvbnN0ICR0aGlzID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4gICAgY29uc3QgdGFyZ2V0ID0gJHRoaXMuYXR0cihcImRhdGEtc2Nyb2xsLXRvXCIpO1xyXG4gICAgY29uc3QgcmVxU2VjdGlvbiA9ICQoYFtkYXRhLXNlY3Rpb24taWQ9JHt0YXJnZXR9XWApO1xyXG5cclxuICAgIHBlcmZvcm1UcmFuc2l0aW9uKHJlcVNlY3Rpb24uaW5kZXgoKSk7XHJcbn0pO1xyXG5cclxuaWYgKGlzTW9iaWxlKSB7XHJcbiAgICAkKFwiYm9keVwiKS5zd2lwZSh7XHJcbiAgICAgICAgc3dpcGU6IGZ1bmN0aW9uIChldmVudCwgZGlyZWN0aW9uKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNjcm9sbGVyID0gdmlld3BvcnRTY3JvbGxlcigpO1xyXG4gICAgICAgICAgICBsZXQgc2Nyb2xsRGlyZWN0aW9uID0gXCJcIjtcclxuXHJcbiAgICAgICAgICAgIGlmIChkaXJlY3Rpb24gPT09IFwidXBcIikgc2Nyb2xsRGlyZWN0aW9uID0gXCJuZXh0XCI7XHJcbiAgICAgICAgICAgIGlmIChkaXJlY3Rpb24gPT09IFwiZG93blwiKSBzY3JvbGxEaXJlY3Rpb24gPSBcInByZXZcIjtcclxuXHJcbiAgICAgICAgICAgIHNjcm9sbGVyW3Njcm9sbERpcmVjdGlvbl0oKTtcclxuICAgICAgICB9LFxyXG4gICAgfSk7XHJcbn0iLCJsZXQgdmlkZW87XHJcbmxldCBkdXJhdGlvbkNvbnRyb2w7XHJcbmxldCBzb3VuZENvbnRyb2w7XHJcbmxldCBpbnRlcnZhbElkO1xyXG5cclxuY29uc3QgcGxheUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudmlkZW9fX3BsYXllci1pbWdcIik7XHJcbmNvbnN0IHNvdW5kQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zb3VuZFwiKTtcclxuY29uc3QgcGxheWVyUGxheUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZHVyYXRpb25fX2ltZ1wiKTtcclxuXHJcblxyXG52aWRlbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGxheWVyXCIpO1xyXG5cclxuXHJcbnZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcGxheVN0b3ApO1xyXG5cclxubGV0IHBsYXlCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5wbGF5XCIpO1xyXG5mb3IgKGxldCBpID0gMDsgaSA8IHBsYXlCdXR0b25zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICBwbGF5QnV0dG9uc1tpXS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHBsYXlTdG9wKTtcclxufVxyXG5cclxubGV0IG1pY0NvbnRyb2wgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1pY1wiKTtcclxubWljQ29udHJvbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNvdW5kT2YpO1xyXG5cclxuZHVyYXRpb25Db250cm9sID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJkdXJhdGlvbkxldmVsXCIpO1xyXG5kdXJhdGlvbkNvbnRyb2wuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBzZXRWaWRlb0R1cmF0aW9uKTtcclxuXHJcbmR1cmF0aW9uQ29udHJvbC5taW4gPSAwO1xyXG5kdXJhdGlvbkNvbnRyb2wudmFsdWUgPSAwO1xyXG5kdXJhdGlvbkNvbnRyb2wubWF4ID0gdmlkZW8uZHVyYXRpb247XHJcblxyXG5zb3VuZENvbnRyb2wgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1pY0xldmVsXCIpO1xyXG5zb3VuZENvbnRyb2wuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBjaGFuZ2VTb3VuZFZvbHVtZSk7XHJcblxyXG5zb3VuZENvbnRyb2wubWluID0gMDtcclxuc291bmRDb250cm9sLm1heCA9IDEwO1xyXG5zb3VuZENvbnRyb2wudmFsdWUgPSBzb3VuZENvbnRyb2wubWF4O1xyXG5cclxuXHJcbnZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZGVkJywgZnVuY3Rpb24gKCkge1xyXG4gICAgcGxheUJ0bi5jbGFzc0xpc3QudG9nZ2xlKFwidmlkZW9fX3BsYXllci1pbWctLWFjdGl2ZVwiKTtcclxuICAgIHZpZGVvLmN1cnJlbnRUaW1lID0gMDtcclxuICAgIHBsYXllclBsYXlCdG4uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XHJcbn0pO1xyXG5cclxuXHJcblxyXG5mdW5jdGlvbiBwbGF5U3RvcCgpIHtcclxuICAgIHBsYXlCdG4uY2xhc3NMaXN0LnRvZ2dsZShcInZpZGVvX19wbGF5ZXItaW1nLS1hY3RpdmVcIik7XHJcblxyXG5cclxuICAgIGlmICh2aWRlby5wYXVzZWQpIHtcclxuICAgICAgICB2aWRlby5wbGF5KCk7XHJcbiAgICAgICAgaW50ZXJ2YWxJZCA9IHNldEludGVydmFsKHVwZGF0ZUR1cmF0aW9uLCAxMDAwIC8gNjApO1xyXG4gICAgICAgIHBsYXllclBsYXlCdG4uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHZpZGVvLnBhdXNlKCk7XHJcbiAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbElkKTtcclxuICAgICAgICBwbGF5ZXJQbGF5QnRuLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBzZXRWaWRlb0R1cmF0aW9uKCkge1xyXG4gICAgdmlkZW8uY3VycmVudFRpbWUgPSBkdXJhdGlvbkNvbnRyb2wudmFsdWU7XHJcbiAgICB1cGRhdGVEdXJhdGlvbigpO1xyXG59XHJcblxyXG5cclxuZnVuY3Rpb24gdXBkYXRlRHVyYXRpb24oKSB7XHJcbiAgICBkdXJhdGlvbkNvbnRyb2wudmFsdWUgPSB2aWRlby5jdXJyZW50VGltZTtcclxuICAgIGxldCBzdGVwID0gdmlkZW8uZHVyYXRpb24gLyAxMDA7XHJcbiAgICBsZXQgcGVyY2VudCA9IHZpZGVvLmN1cnJlbnRUaW1lIC8gc3RlcDtcclxuICAgIGR1cmF0aW9uQ29udHJvbC5zdHlsZS5iYWNrZ3JvdW5kID0gYGxpbmVhci1ncmFkaWVudCg5MGRlZywgI0UwMUYzRCAwJSwgI0UwMUYzRCAke3BlcmNlbnR9JSwgIzMzMzMzMyAke3BlcmNlbnR9JSlgO1xyXG5cclxufVxyXG5cclxuXHJcbmZ1bmN0aW9uIHNvdW5kT2YoKSB7XHJcbiAgICBpZiAodmlkZW8udm9sdW1lID09PSAwKSB7XHJcbiAgICAgICAgdmlkZW8udm9sdW1lID0gc291bmRMZXZlbDtcclxuICAgICAgICBzb3VuZENvbnRyb2wudmFsdWUgPSBzb3VuZExldmVsICogMTA7XHJcbiAgICAgICAgc291bmRCdG4uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHNvdW5kTGV2ZWwgPSB2aWRlby52b2x1bWU7XHJcbiAgICAgICAgdmlkZW8udm9sdW1lID0gMDtcclxuICAgICAgICBzb3VuZENvbnRyb2wudmFsdWUgPSAwO1xyXG4gICAgICAgIHNvdW5kQnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xyXG5cclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gY2hhbmdlU291bmRWb2x1bWUoKSB7XHJcbiAgICB2aWRlby52b2x1bWUgPSBzb3VuZENvbnRyb2wudmFsdWUgLyAxMDtcclxuICAgIGlmICh2aWRlby52b2x1bWUgPT0gMCkge1xyXG4gICAgICAgIHNvdW5kQnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBzb3VuZEJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcclxuICAgIH1cclxuICAgIGNvbnNvbGUubG9nKCfQt9C90LDRh9C10L3QuNC1IHZvbHVtZSDRgyDQstC40LTQtdC+ICcgKyB2aWRlby52b2x1bWUpO1xyXG4gICAgY29uc29sZS5sb2coJ9C30L3QsNGH0LXQvdC40LUgdmFsdWUg0YMgbWljTGV2ZWwgJyArIHNvdW5kQ29udHJvbC52YWx1ZSAvIDEwKTtcclxufSIsImNvbnN0IGZpbmRCbG9ja0J5QWxpYXMgPSAoYWxpYXMpID0+IHtcclxuICAgIHJldHVybiAkKFwiLnJld2lld3NfX2l0ZW1cIikuZmlsdGVyKChuZHgsIGl0ZW0pID0+IHtcclxuICAgICAgICByZXR1cm4gJChpdGVtKS5hdHRyKFwiZGF0YS1saW5rXCIpID09IGFsaWFzO1xyXG4gICAgfSk7XHJcbn07XHJcblxyXG4kKFwiLmludGVyYWN0aXZlLWF2YXRhclwiKS5jbGljaygoZSkgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgIGNvbnN0ICR0aGlzID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4gICAgY29uc3QgY3VycmVudCA9ICR0aGlzLmF0dHIoXCJkYXRhLW9wZW5cIik7XHJcbiAgICBjb25zdCBpdGVtVG9TaG93ID0gZmluZEJsb2NrQnlBbGlhcyhjdXJyZW50KTtcclxuICAgIGNvbnN0IGN1ckl0ZW0gPSAkdGhpcy5jbG9zZXN0KFwiLnJld2lld3NfX3N3aXRjaGVyLWl0ZW1cIik7XHJcblxyXG4gICAgaXRlbVRvU2hvdy5hZGRDbGFzcyhcInJld2lld3NfX2l0ZW0tLWFjdGl2ZVwiKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKFwicmV3aWV3c19faXRlbS0tYWN0aXZlXCIpO1xyXG4gICAgY3VySXRlbS5hZGRDbGFzcyhcImludGVyYWN0aXZlLWF2YXRhci0tYWN0aXZlXCIpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoXCJpbnRlcmFjdGl2ZS1hdmF0YXItLWFjdGl2ZVwiKTtcclxufSkiLCJjb25zdCBzbGlkZXIgPSAkKFwiLnNsaWRlcl9fbGlzdFwiKS5ieFNsaWRlcih7XHJcbiAgICBwYWdlcjogZmFsc2UsXHJcbiAgICBjb250cm9sczogZmFsc2UsXHJcbn0pO1xyXG5cclxuJChcIi5zbGlkZXJfX2J1dHRvbi0tcHJldlwiKS5jbGljaygoZSkgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgc2xpZGVyLmdvVG9QcmV2U2xpZGUoKTtcclxufSk7XHJcblxyXG5cclxuJChcIi5zbGlkZXJfX2J1dHRvbi0tbmV4dFwiKS5jbGljaygoZSkgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgc2xpZGVyLmdvVG9OZXh0U2xpZGUoKTtcclxufSkiLCJjb25zdCBvcGVuSXRlbSA9IGl0ZW0gPT4ge1xyXG4gICAgY29uc3QgY29udGFpbmVyID0gaXRlbS5jbG9zZXN0KFwiLnRlYW1fX2l0ZW1cIik7XHJcbiAgICBjb25zdCBjb250ZW50QmxvY2sgPSBjb250YWluZXIuZmluZChcIi50ZWFtX19jb250ZW50XCIpO1xyXG4gICAgY29uc3QgdGV4dEJsb2NrID0gY29udGVudEJsb2NrLmZpbmQoXCIudGVhbV9fY29udGVudC1ibG9ja1wiKTtcclxuICAgIGNvbnN0IHJlcUhlaWdodCA9IHRleHRCbG9jay5oZWlnaHQoKTtcclxuXHJcbiAgICBjb250YWluZXIuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgICBjb250ZW50QmxvY2suaGVpZ2h0KHJlcUhlaWdodCk7XHJcbn07XHJcblxyXG5jb25zdCBjbG9zZUV2ZXJ5SXRlbSA9IGNvbnRhaW5lciA9PiB7XHJcbiAgICBjb25zdCBpdGVtcyA9IGNvbnRhaW5lci5maW5kKFwiLnRlYW1fX2NvbnRlbnRcIik7XHJcbiAgICBjb25zdCBpdGVtQ29udGFpbmVyID0gY29udGFpbmVyLmZpbmQoXCIudGVhbV9faXRlbVwiKTtcclxuXHJcbiAgICBpdGVtQ29udGFpbmVyLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xyXG4gICAgaXRlbXMuaGVpZ2h0KDApO1xyXG59O1xyXG5cclxuJChcIi50ZWFtX19uYW1lXCIpLmNsaWNrKGUgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgY29uc3QgJHRoaXMgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgICBjb25zdCBjb250YWluZXIgPSAkdGhpcy5jbG9zZXN0KFwiLnRlYW1cIik7XHJcbiAgICBjb25zdCBlbGVtQ29udGFpbmVyID0gJHRoaXMuY2xvc2VzdChcIi50ZWFtX19pdGVtXCIpO1xyXG5cclxuICAgIGlmIChlbGVtQ29udGFpbmVyLmhhc0NsYXNzKFwiYWN0aXZlXCIpKSB7XHJcbiAgICBjbG9zZUV2ZXJ5SXRlbShjb250YWluZXIpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgIGNsb3NlRXZlcnlJdGVtKGNvbnRhaW5lcik7XHJcbiAgICBvcGVuSXRlbSgkdGhpcyk7XHJcbiAgICB9XHJcbiAgICBcclxufSk7Il19
